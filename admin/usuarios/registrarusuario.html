<!DOCTYPE html>
<html lang="en">

<head>
    <title>registrarusuario</title>
    <link rel="icon" type="image/x-icon" href="/img/logoGiroofi.png" />
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Roboto:wght@700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="/style/index.css">
    <link rel="stylesheet" href="/style/formularios.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
</head>

<body>
    <header>
        <div class="logo-container">
            <img src="/img/logoGiroofi.png" alt="Logo Izquierda" class="logo">
        </div>
        <div class="title-container">
            <h1>PUNTO GIRO</h1>
            <h2>CONTROL DE STOCK</h2>
        </div>
        <div>
            <button type="button" class="logOut">cerrar sesion</button>
        </div>
    </header>
    <nav>
        <ul>
            <li>
                <a href="/admin/index.html">
                    <i class="fas fa-home"></i>>
                </a>
            </li>
            <li><a href="usuarioadmin.html">Usuarios ></a></li>
            <li><a href="">Registrar Usuario</a></li>
        </ul>
    </nav>
    <br>
    <br>

    <h3>REGISTRO DE USUARIO</h3>
    <div>
        <!-- ID (oculto) -->
        <input type="hidden" id="txtIDUSUARIO" name="id_usuario" value="0">

        <!-- Nombre Completo -->
        <label for="txtNombreCompleto">Nombre Completo:</label>
        <input type="text" id="txtNombreCompleto" name="nombre_completo" value="" required><br><br>

        <!-- DNI -->
        <label for="txtDNIUsuario">DNI:</label>
        <input type="text" id="txtDNIUsuario" name="dni" value="" required><br><br>

        <!-- Nombre de Usuario -->
        <label for="txtNombreUsuario">Nombre de Usuario:</label>
        <input type="text" id="txtNombreUsuario" name="nombre_usuario" value="" required><br><br>

        <!-- Email -->
        <label for="txtEmailUsuario">Email:</label>
        <input type="email" id="txtEmailUsuario" name="email" value="" required><br><br>

        <!-- Tipo de Rol -->
        <label for="txtTipoRolUsuario">Tipo de Rol:</label>
        <select id="txtTipoRolUsuario" name="tipo_rol" required>
            <option value="" disabled selected>Selecciona una opción</option>
            <option value="ADMIN">ADMIN</option>
            <option value="VIEWR">VIEWER</option>
        </select><br><br>

        <label for="txtPuntoDeControl">Punto De Control:</label>
        <select id="txtPuntoDeControl" name="punto_de_control" required>
            <option value="" disabled selected>Selecciona una opción</option>
            <option value="2">Chacarita</option>
            <option value="3">Oficina</option>
            <option value="4">Predio Ferial</option>
            <option value="5">Valle Chico</option>
        </select><br><br>

        <!-- Contraseña -->
        <label for="txtContraseñaUsuario">Contraseña:</label>
        <input type="password" id="txtContraseñaUsuario" name="password" required><br><br>

        <!-- Habilitado -->
        <label for="habilitadoUsuario">Activo:</label>
        <input type="radio" id="habilitadoSi" name="habilitado" value="true" required> Sí
        <input type="radio" id="habilitadoNo" name="habilitado" value="false" required> No<br><br>

        <!-- Botones -->
        <input type="submit" value="Registrar" id="btnRegistrarUsuario">
        <input type="button" value="Cancelar" id="btnCancelarUsuario">
    </div>

    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <footer>
        <div class="footer-content">
            <p>&copy; 2024 Punto Giro. Todos los derechos reservados.</p>
            <!-- <p>Diseñado por [Tu Nombre]</p> -->
        </div>
    </footer>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            cerrarSesion()
            validarSesion()
            crearUsuario()
        })

        function cerrarSesion(){
            let cerrarSesion= document.querySelector(".logOut")
            cerrarSesion.addEventListener("click",function(){
                localStorage.clear()
                window.location.href = "../auth/login.html"
            })
          }
      
        function validarSesion(){
            let sesion= localStorage.getItem("isLoggedIn")
            let userSession= localStorage.getItem("userSession")
            if(!sesion || !userSession){
              window.location.href = "../auth/login.html"
            }
          }

        function crearUsuario() {

            const btnRegistrarUsuario = document.querySelector("#btnRegistrarUsuario");

            btnRegistrarUsuario.addEventListener("click", async () => {

                let nombre_completo = txtNombreCompleto.value;
                let dni = txtDNIUsuario.value;
                let nombre_usuario = txtNombreUsuario.value;
                let email = txtEmailUsuario.value;
                let tipo_usuario = txtTipoRolUsuario.value;
                let password = txtContraseñaUsuario.value;
                let activo = document.querySelector('input[name="habilitado"]:checked').value;
                let punto_de_control_id= txtPuntoDeControl.value;
                


                const usuarioData = {
                    nombre_completo,
                    dni,
                    nombre_usuario,
                    email,
                    tipo_usuario,
                    password,
                    activo,
                    punto_de_control_id
                };


                try {

                    const response = await fetch('http://localhost:3000/api-giro/usuario/', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(usuarioData)
                    });

                    const result = await response.json();

                    if (result.success) {

                        Swal.fire(
                            'Exito!',
                            result.result_message,
                            'success'
                        ).then(() => {
                            window.location.href = "usuarioadmin.html"
                        });

                        txtNombreCompleto.value = '';
                        txtNombreUsuario.value = '';
                        txtDNIUsuario.value = '';
                        txtEmailUsuario.value = '';
                        txtTipoRolUsuario.value = '';
                        txtPuntoDeControl.value= '';
                        txtContraseñaUsuario.value = '';
                        document.querySelector('input[name="habilitado"]:checked').checked = false;

                    } else {
                        Swal.fire(
                            'Error',
                            result.result_message || 'No se pudo crear el usuario.',
                            'error'
                        );
                    }
                } catch (error) {
                    console.log(`Se produjo un error: ${error.message}`);
                }
            });
        }
    </script>

</body>

</html>